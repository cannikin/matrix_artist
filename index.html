<!DOCTYPE html>
<html>
<head>
	<title>Matrix Artist</title>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
  <script type="text/javascript">

    var Matrix = {
      // contains a reference to the container for the matrix graphic
      container:null,
      
      // an array of all colors to cycle through
      colors:['#000000','#ff0000','#00ff00','#0000ff','#ffff00','#00ffff','#ff00ff','#ffffff'],
      
      // what to start the color variable names with
      startVarName:'AA',
      
      // setup the matrix
      setup:function(obj) {
        var self = this;
        
        // save the container
        this.container = $(obj);
        
        // add all the individual cells
        var html = '';
        for (var x=0; x<8; x++) {
          html += '<div class="row">';
          for (var y=0; y<8; y++) {
            html += '<div id="'+x+'_'+y+'" class="cell"></div>';
          }
          html += '</div>';
        }
        
        // add the cells to the page
        this.container.html(html);
        
        this.container.find('.cell').each(function() {
          self.changeColor(this,0);   // set the initial state to white
        }).click(function() {
          self.changeColor(this);     // when clicking a cell, cycle through the colors
        });
        
        // setup the 'gimmie the code' button
        var form = '';
        form += '<form id="code">';
        form += '<input type="button" value="Gimmie the Code" id="gimmie">';
        form += '<input type="button" value="Reset" id="reset">';
        form += '<textarea style="display:none;">asdf</textarea>';
        form += '</form>';
        
        this.container.after(form);
        $('#gimmie').click(function() {
          self.getCode();
        });
        $('#reset').click(function() {
          self.reset();
        });
      },
      
      // changes the color of the cell, either to the next in the chain or to a specific color that was passed in
      changeColor:function(obj,color_index) {
        var new_color = color_index;
        if (new_color == undefined) {
          // figure out what the next color in the chain is
          var current_color = $(obj).data('color_index');
          if (current_color == (this.colors.length - 1)) {
            // if we reached the end of the color chain, start over
            new_color = 0;
          } else {
            new_color = current_color + 1;
          }
        } else {
          // if we passed in a color, use that no matter what
          new_color = color_index;
        }
        $(obj).css('backgroundColor',this.colors[new_color]).data('color_index',new_color);
      },
      
      reset:function() {
        var self = this;
        this.container.find('.cell').each(function() {
          self.changeColor(this,0);   // set the initial state to white
        });
      },
      
      // gets the arduino/wiring code
      getCode:function() {
        var code = "// Generated by Matrix Artist: http://github.com/cannikin/matrix_artist\n\n";
        var varName = this.startVarName;
        var vars = [];
        var colorByte;
        
        // generate variables for all the colors
        for(var i=0;i<this.colors.length;i++) {
          code += "const byte " + varName + " = 0x";
          colorByte = this.colorToByte(this.colors[i]);
          if (colorByte.length == 1) {
            code += '0';
          }
          code += colorByte + ";\n";
          vars.push(varName);
          varName = this.nextVarName(varName);
        }
        
        // generate the array that represents this picture
        var cell_counter = 1;
        code += "\nbyte image[] = {\n";
        this.container.find('div.cell').each(function() {
          code += vars[$(this).data('color_index')] + ',';
          if (cell_counter % 8 == 0) {
            code += "\n";
          }
          cell_counter++;
        });
        code += "};";
        
        $('form textarea').text(code).show().select();
      },
      
      // converts a hex color code to a single byte
      colorToByte:function(color) {
        var red = parseInt(color.substr(1,2),16) & 0xE0;
        var green = parseInt(color.substr(3,2),16) & 0x1C;
        var blue = parseInt(color.substr(5,2),16) & 0x03;
        return (red | green | blue).toString(16);
      },
      
      // figures out the next name in a sequence of alphabetical variable names: AA, AB, AC
      nextVarName:function(varName) {
        firstChar = varName[0];
        lastChar = varName[1];
        if (lastChar.charCodeAt(0) == 90) {
          return String.fromCharCode(firstChar.charCodeAt(0) + 1) + 'A';
        } else {
          return firstChar + String.fromCharCode(lastChar.charCodeAt(0) + 1);
        }
      },
      
      // start the whole thing off
      start:function(obj) {
        this.setup(obj);
      }
    }
    
    $(document).ready(function() { Matrix.start('#matrix') });
  </script>

	<style type="text/css">
	  html{color:#000;background:#FFF}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}address,caption,cite,code,dfn,em,strong,th,var{font-style:normal;font-weight:normal}li{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal}q:before,q:after{content:''}abbr,acronym{border:0;font-variant:normal}sup{vertical-align:text-top}sub{vertical-align:text-bottom}input,textarea,select{font-family:inherit;font-size:inherit;font-weight:inherit}input,textarea,select{*font-size:100%}legend{color:#000}body{font:13px/1.231 Helvetica,Arial,sans-serif;*font-size:small;*font:x-small}table{font-size:inherit;font:100%}pre,code,kbd,samp,tt{font-family:monospace;*font-size:108%;line-height:100%}
    html {
      background-color: #eeeeee;
      }
    #container {
      width: 600px;
      margin: 0 auto;
      }
      h1 {
        text-align: center;
        font-family: Georgia, serif;
        font-size: 600%;
        margin: 0 0.2em;
        color: #aaaaaa;
        }
    form {
      margin: 1em auto;
      text-align: center;
      }
      form input {
        }
      form textarea{
        margin: 1em 0;
        width: 45em;
        height: 26em;
        font-size: 116%;
        font-family: Menlo, Monaco, monospace;
        -moz-border-radius: 6px;
        -webkit-border-radius: 6px;
        border-radius: 6px;
        border: 2px solid #cccccc;
        padding: 1em;
        }
    #matrix {
      background-color: #333333;
      width: 304px;
      margin: 0 auto;
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      }
  	  #matrix div.row {
        overflow: hidden;
        }
      #matrix div.row div {
        float: left;
        width: 32px;
        height: 32px;
        margin: 3px;
        -webkit-border-radius: 16px;
        -moz-border-radius: 16px;
        border-radius: 16px;
        background-color: #ffffff;
        }
	</style>
</head>
<body>
  <h1>Matrix Artist</h1>
  <div id="container">
    <div id="matrix"></div>
  </div>
</body>
</html>
